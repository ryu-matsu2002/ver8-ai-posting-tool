{# ğŸ“„ templates/auto_post.html #}
{% extends "base.html" %}

{% block title %}è¨˜äº‹ç”Ÿæˆï¼†è‡ªå‹•æŠ•ç¨¿{% endblock %}

{% block content %}
    <h1>è‡ªå‹•æŠ•ç¨¿ï¼šã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼†ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®š</h1>

    <form method="POST">
        <label for="site_id">æŠ•ç¨¿å…ˆã‚µã‚¤ãƒˆã‚’é¸æŠï¼š</label>
        <select name="site_id" id="site_id" required>
            {% for site in sites %}
                <option value="{{ site.id }}">{{ site.site_url }}</option>
            {% endfor %}
        </select>

        <label for="keywords">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ä¸€è¦§ï¼ˆæœ€å¤§40å€‹ãƒ»1è¡Œãšã¤ï¼‰:</label>
        <textarea name="keywords" id="keywords" rows="10" placeholder="ä¾‹ï¼šæ¸©æ³‰æ—…è¡Œ\nå®¶æ—é€£ã‚Œ\næ ¼å®‰ãƒ›ãƒ†ãƒ«"></textarea>

        {% if prompt_templates %}
        <label for="template_select">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠï¼š</label>
        <select id="template_select" onchange="applyTemplate()">
            <option value="">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„</option>
            {% for template in prompt_templates %}
            <option value='{{ {
                "title_prompt": template.title_prompt,
                "body_prompt": template.body_prompt
            } | tojson }}'>{{ template.genre }}</option>
            {% endfor %}
        </select>
        {% endif %}

        <label for="title_prompt">è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«ç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ:</label>
        <textarea name="title_prompt" id="title_prompt" rows="6" placeholder="ä¾‹ï¼šä»¥ä¸‹ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦SEOã«å¼·ã„è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«ã‚’1ã¤ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: {{keyword}}"></textarea>

        <label for="body_prompt">è¨˜äº‹æœ¬æ–‡ç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ:</label>
        <textarea name="body_prompt" id="body_prompt" rows="10" placeholder="ä¾‹ï¼šä»¥ä¸‹ã®ã‚¿ã‚¤ãƒˆãƒ«ã«åŸºã¥ã„ã¦SEOã«å¼·ã„è¨˜äº‹ã‚’2500ï½3500æ–‡å­—ã§æ›¸ã„ã¦ãã ã•ã„ã€‚ã‚¿ã‚¤ãƒˆãƒ«: {{title}}"></textarea>

        <button type="submit">è¨˜äº‹ç”Ÿæˆã‚’é–‹å§‹</button>
    </form>
{% endblock %}

{% block scripts %}
<script>
    function applyTemplate() {
        const select = document.getElementById("template_select");
        const selected = JSON.parse(select.value);
        if (selected) {
            document.getElementById("title_prompt").value = selected.title_prompt;
            document.getElementById("body_prompt").value = selected.body_prompt;
        }
    }

    window.onload = function () {
        const titlePrompt = sessionStorage.getItem("title_prompt");
        const bodyPrompt = sessionStorage.getItem("body_prompt");
        if (titlePrompt && bodyPrompt) {
            document.getElementById("title_prompt").value = titlePrompt;
            document.getElementById("body_prompt").value = bodyPrompt;
            sessionStorage.removeItem("title_prompt");
            sessionStorage.removeItem("body_prompt");
        }
    };
</script>
{% endblock %}
