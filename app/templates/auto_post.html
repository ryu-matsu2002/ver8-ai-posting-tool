{# 📄 templates/auto_post.html #}
{% extends "base.html" %}

{% block title %}記事生成＆自動投稿{% endblock %}

{% block content %}
<div style="max-width: 900px; margin: 0 auto; padding: 20px;">
    <h1 style="font-size: 28px; border-bottom: 2px solid #ccc; padding-bottom: 10px; margin-bottom: 25px;">
        自動投稿：キーワード＆テンプレート選択
    </h1>

    <form method="POST" style="display: flex; flex-direction: column; gap: 20px;">
        <div>
            <label for="site_id" style="font-weight: bold;">投稿先サイトを選択：</label><br>
            <select name="site_id" id="site_id" required style="width: 100%; padding: 8px;">
                {% for site in sites %}
                    <option value="{{ site.id }}">{{ site.site_url }}</option>
                {% endfor %}
            </select>
        </div>

        <div>
            <label for="keywords" style="font-weight: bold;">キーワード一覧（最大40個・1行ずつ）:</label><br>
            <textarea name="keywords" id="keywords" rows="6" style="width: 100%; padding: 10px;" placeholder="例：温泉旅行\n家族連れ\n格安ホテル"></textarea>
        </div>

        {% if prompt_templates %}
        <div>
            <label for="template_select" style="font-weight: bold;">テンプレートを選択：</label><br>
            <select name="template_id" id="template_select" onchange="applyTemplate()" style="width: 100%; padding: 8px;" required>
                <option value="">テンプレートを選択してください</option>
                {% for template in prompt_templates %}
                <option value="{{ template.id }}"
                        data-title="{{ template.title_prompt | e }}"
                        data-body="{{ template.body_prompt | e }}">
                    {{ template.genre }}
                </option>
                {% endfor %}
            </select>
        </div>
        {% endif %}

        <!-- 非表示のプロンプト送信用 -->
        <input type="hidden" name="title_prompt" id="title_prompt">
        <input type="hidden" name="body_prompt" id="body_prompt">

        <div style="text-align: center; margin-top: 10px;">
            <button type="submit" style="padding: 10px 30px; background-color: #007bff; color: white; font-weight: bold; border: none; border-radius: 5px; cursor: pointer;">
                記事生成を開始
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
    function applyTemplate() {
        const select = document.getElementById("template_select");
        const selected = select.options[select.selectedIndex];
        const title = selected.getAttribute("data-title");
        const body = selected.getAttribute("data-body");
        if (title && body) {
            document.getElementById("title_prompt").value = title;
            document.getElementById("body_prompt").value = body;
        }
    }
</script>
{% endblock %}
