{# ğŸ“„ templates/auto_post.html #}
{% extends "base.html" %}

{% block title %}è¨˜äº‹ç”Ÿæˆï¼†è‡ªå‹•æŠ•ç¨¿{% endblock %}

{% block content %}
    <div style="max-width: 900px; margin: 0 auto; padding: 20px;">
        <h1 style="font-size: 28px; border-bottom: 2px solid #ccc; padding-bottom: 10px; margin-bottom: 25px;">
            è‡ªå‹•æŠ•ç¨¿ï¼šã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼†ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®š
        </h1>

        <form method="POST" style="display: flex; flex-direction: column; gap: 20px;">
            <div>
                <label for="site_id" style="font-weight: bold;">æŠ•ç¨¿å…ˆã‚µã‚¤ãƒˆã‚’é¸æŠï¼š</label><br>
                <select name="site_id" id="site_id" required style="width: 100%; padding: 8px;">
                    {% for site in sites %}
                        <option value="{{ site.id }}">{{ site.site_url }}</option>
                    {% endfor %}
                </select>
            </div>

            <div>
                <label for="keywords" style="font-weight: bold;">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ä¸€è¦§ï¼ˆæœ€å¤§40å€‹ãƒ»1è¡Œãšã¤ï¼‰:</label><br>
                <textarea name="keywords" id="keywords" rows="6" style="width: 100%; padding: 10px;" placeholder="ä¾‹ï¼šæ¸©æ³‰æ—…è¡Œ\nå®¶æ—é€£ã‚Œ\næ ¼å®‰ãƒ›ãƒ†ãƒ«"></textarea>
            </div>

            {% if prompt_templates %}
            <div>
                <label for="template_select" style="font-weight: bold;">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠï¼š</label><br>
                <select id="template_select" onchange="applyTemplate()" style="width: 100%; padding: 8px;">
                    <option value="">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                    {% for template in prompt_templates %}
                    <option value='{{ {
                        "title_prompt": template.title_prompt,
                        "body_prompt": template.body_prompt
                    } | tojson }}'>{{ template.genre }}</option>
                    {% endfor %}
                </select>
            </div>
            {% endif %}

            <div>
                <label for="title_prompt" style="font-weight: bold;">è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«ç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ:</label><br>
                <textarea name="title_prompt" id="title_prompt" rows="5" style="width: 100%; padding: 10px;" placeholder="ä¾‹ï¼šä»¥ä¸‹ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦SEOã«å¼·ã„è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«ã‚’1ã¤ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: {{keyword}}"></textarea>
            </div>

            <div>
                <label for="body_prompt" style="font-weight: bold;">è¨˜äº‹æœ¬æ–‡ç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ:</label><br>
                <textarea name="body_prompt" id="body_prompt" rows="8" style="width: 100%; padding: 10px;" placeholder="ä¾‹ï¼šä»¥ä¸‹ã®ã‚¿ã‚¤ãƒˆãƒ«ã«åŸºã¥ã„ã¦SEOã«å¼·ã„è¨˜äº‹ã‚’2500ï½3500æ–‡å­—ã§æ›¸ã„ã¦ãã ã•ã„ã€‚ã‚¿ã‚¤ãƒˆãƒ«: {{title}}"></textarea>
            </div>

            <div style="text-align: center; margin-top: 10px;">
                <button type="submit" style="padding: 10px 30px; background-color: #007bff; color: white; font-weight: bold; border: none; border-radius: 5px; cursor: pointer;">
                    è¨˜äº‹ç”Ÿæˆã‚’é–‹å§‹
                </button>
            </div>
        </form>
    </div>
{% endblock %}

{% block scripts %}
<script>
    function applyTemplate() {
        const select = document.getElementById("template_select");
        const selected = JSON.parse(select.value);
        if (selected) {
            document.getElementById("title_prompt").value = selected.title_prompt;
            document.getElementById("body_prompt").value = selected.body_prompt;
        }
    }

    window.onload = function () {
        const titlePrompt = sessionStorage.getItem("title_prompt");
        const bodyPrompt = sessionStorage.getItem("body_prompt");
        if (titlePrompt && bodyPrompt) {
            document.getElementById("title_prompt").value = titlePrompt;
            document.getElementById("body_prompt").value = bodyPrompt;
            sessionStorage.removeItem("title_prompt");
            sessionStorage.removeItem("body_prompt");
        }
    };
</script>
{% endblock %}
