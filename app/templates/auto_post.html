{# ğŸ“„ templates/auto_post.html #}
{% extends "base.html" %}

{% block title %}è¨˜äº‹ç”Ÿæˆï¼†è‡ªå‹•æŠ•ç¨¿{% endblock %}

{% block content %}
<div style="max-width: 900px; margin: 0 auto; padding: 20px;">
    <h1 style="font-size: 28px; border-bottom: 2px solid #ccc; padding-bottom: 10px; margin-bottom: 25px;">
        è‡ªå‹•æŠ•ç¨¿ï¼šã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼†ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ
    </h1>

    <form method="POST" onsubmit="return validateAndSubmit()" style="display: flex; flex-direction: column; gap: 20px;">
        <div>
            <label for="site_id" style="font-weight: bold;">æŠ•ç¨¿å…ˆã‚µã‚¤ãƒˆã‚’é¸æŠï¼š</label><br>
            <select name="site_id" id="site_id" required style="width: 100%; padding: 8px;">
                {% for site in sites %}
                    <option value="{{ site.id }}">{{ site.site_url }}</option>
                {% endfor %}
            </select>
        </div>

        <div>
            <label for="keywords" style="font-weight: bold;">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ä¸€è¦§ï¼ˆæœ€å¤§40å€‹ãƒ»1è¡Œãšã¤ï¼‰:</label><br>
            <textarea name="keywords" id="keywords" rows="6" style="width: 100%; padding: 10px;" placeholder="ä¾‹ï¼šæ¸©æ³‰æ—…è¡Œ\nå®¶æ—é€£ã‚Œ\næ ¼å®‰ãƒ›ãƒ†ãƒ«"></textarea>
        </div>

        {% if prompt_templates %}
        <div>
            <label for="template_select" style="font-weight: bold;">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠï¼š</label><br>
            <select id="template_select" style="width: 100%; padding: 8px;" required>
                <option value="">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                {% for template in prompt_templates %}
                <option value='{{ {
                    "id": template.id,
                    "title_prompt": template.title_prompt,
                    "body_prompt": template.body_prompt
                } | tojson }}'>{{ template.genre }}</option>
                {% endfor %}
            </select>
        </div>
        {% endif %}

        <!-- hidden inputs ã«é¸æŠã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæƒ…å ±ã‚’æ ¼ç´ -->
        <input type="hidden" name="title_prompt" id="title_prompt">
        <input type="hidden" name="body_prompt" id="body_prompt">
        <input type="hidden" name="template_id" id="template_id">

        <div style="text-align: center; margin-top: 10px;">
            <button type="submit" style="padding: 10px 30px; background-color: #007bff; color: white; font-weight: bold; border: none; border-radius: 5px; cursor: pointer;">
                è¨˜äº‹ç”Ÿæˆã‚’é–‹å§‹
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
    // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã§ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ hidden input ã«ä»£å…¥
    document.getElementById("template_select").addEventListener("change", function () {
        const selected = JSON.parse(this.value || "{}");
        document.getElementById("title_prompt").value = selected.title_prompt || "";
        document.getElementById("body_prompt").value = selected.body_prompt || "";
        document.getElementById("template_id").value = selected.id || "";
    });

    // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¨é€ä¿¡åˆ¶å¾¡
    function validateAndSubmit() {
        const titlePrompt = document.getElementById("title_prompt").value.trim();
        const bodyPrompt = document.getElementById("body_prompt").value.trim();
        const keywords = document.getElementById("keywords").value.trim();

        if (!titlePrompt || !bodyPrompt) {
            alert("ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
            return false;
        }

        if (!keywords) {
            alert("ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
            return false;
        }

        return true;
    }
</script>
{% endblock %}
